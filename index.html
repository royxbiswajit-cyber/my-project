<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hand Controlled Energy Ball</title>
<style>
    body {
        margin:0;
        background:#000;
        overflow:hidden;
    }
    video {
        display:none;
    }
</style>

<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.158.0/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@0.158.0/examples/jsm/"
  }
}
</script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>
<body>

<video id="webcam" autoplay playsinline></video>

<script type="module">
import * as THREE from 'three';

let scene, camera3D, renderer, sphere;
let targetPos = new THREE.Vector3();
let smoothPos = new THREE.Vector3();

function init3D() {
    scene = new THREE.Scene();

    camera3D = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 1000);
    camera3D.position.z = 2;

    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(innerWidth, innerHeight);
    document.body.appendChild(renderer.domElement);

    const glowMat = new THREE.MeshBasicMaterial({
        color:0x64ffda,
        transparent:true,
        opacity:1
    });

    const geo = new THREE.SphereGeometry(0.05, 32, 32);
    sphere = new THREE.Mesh(geo, glowMat);
    scene.add(sphere);
}

function animate() {
    requestAnimationFrame(animate);

    // smooth follow
    smoothPos.lerp(targetPos, 0.15);
    sphere.position.copy(smoothPos);

    renderer.render(scene, camera3D);
}
init3D();
animate();

// ===== Hand Tracking =====
const video = document.getElementById('webcam');

const hands = new Hands({
    locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});
hands.setOptions({
    maxNumHands: 1,
    modelComplexity: 1,
    minDetectionConfidence: 0.6,
    minTrackingConfidence: 0.5
});

hands.onResults(results => {
    if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
        const hand = results.multiHandLandmarks[0];
        let x = hand[9].x;  // center of palm approx
        let y = hand[9].y;
        targetPos.set((x - 0.5)*2, (0.5 - y)*2, 0);
    }
});

const cam = new Camera(video, {
    onFrame: async () => { await hands.send({image: video}); },
    width: 640,
    height: 480
});
cam.start();
</script>
</body>
</html>
