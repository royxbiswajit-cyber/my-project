<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html,body{margin:0; padding:0; background:black; overflow:hidden;}
canvas{position:absolute; top:0; left:0;}
video{position:absolute; bottom:10px; right:10px; width:120px; border-radius:10px;}
</style>
</head>
<body>
<video id="cam" autoplay></video>
<canvas id="three"></canvas>

<script type="module">
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js";

const video = document.getElementById("cam");
navigator.mediaDevices.getUserMedia({video:true}).then(stream=>{
    video.srcObject = stream;
});

const canvas = document.getElementById("three");

// WebGL Fallback Check
const gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
if (!gl) alert("No WebGL!");

// Three.js Renderer
const renderer = new THREE.WebGLRenderer({
    canvas: canvas,
    antialias:true,
    alpha:true,
    powerPreference:"high-performance"
});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);

// Scene + Camera
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 100);
camera.position.z = 3;

// Test object (if this shows = everything working)
const box = new THREE.Mesh(
    new THREE.BoxGeometry(1,1,1),
    new THREE.MeshBasicMaterial({color:0x00ffcc})
);
scene.add(box);

// Render Loop
function animate(){
    box.rotation.y += 0.01;
    box.rotation.x += 0.01;
    renderer.render(scene, camera);
    requestAnimationFrame(animate);
}
animate();

// Resize handler
window.onresize = ()=>{
    renderer.setSize(innerWidth, innerHeight);
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
};
</script>
</body>
</html>
